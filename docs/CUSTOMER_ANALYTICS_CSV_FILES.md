# Customer Analytics CSV Files - Explained

## üìÅ File Structure

There are **3 main CSV files** generated by the analytics scripts:

### 1. `customer_analytics_YYYY-MM-DD.csv`
- **Generated by:** `scripts/analyzeCustomerMetrics.ts`
- **Contains:** Retail API (X-Series) data only
- **Purpose:** Base analytics from Lightspeed Retail POS
- **Use:** Intermediate file - don't use this as your final source

### 2. `customer_analytics_with_ecom_YYYY-MM-DD.csv`
- **Generated by:** `scripts/importEcomCSV.ts`
- **Contains:** eCom order sync status per customer
- **Purpose:** Shows which eCom orders have synced to Retail vs. not synced
- **Use:** Reference file - shows sync status, not final analytics

### 3. `customer_analytics_updated_YYYY-MM-DD.csv` ‚≠ê **THIS IS THE ONE YOU USE**
- **Generated by:** `scripts/mergeEcomIntoAnalytics.ts`
- **Contains:** Base analytics + eCom data merged together
- **Purpose:** **FINAL, COMPLETE customer analytics**
- **Use:** **This is your master file** - use this for all customer analysis

---

## üîÑ Script Execution Order

1. **`importEcomCSV.ts`** ‚Üí Creates `customer_analytics_with_ecom_YYYY-MM-DD.csv`
2. **`analyzeCustomerMetrics.ts`** ‚Üí Creates `customer_analytics_YYYY-MM-DD.csv`
3. **`mergeEcomIntoAnalytics.ts`** ‚Üí Creates `customer_analytics_updated_YYYY-MM-DD.csv` ‚≠ê

**Always use the `customer_analytics_updated_YYYY-MM-DD.csv` file!**

---

## ‚ö†Ô∏è About Repeat Emails

### The `wrmeans11833@gmail.com` Issue

**This is NOT a bug - it's a data quality issue from Lightspeed:**

- `wrmeans11833@gmail.com` appears **438 times** in the CSV
- These are **438 DIFFERENT customers** (different IDs, names, phones)
- This email is a **PLACEHOLDER/DEFAULT** used by Lightspeed when customers don't provide an email
- It's NOT the same person - it's 438 separate customers who all have this placeholder

**Example:**
- Customer 1: "Zack B." with phone 9312486206 ‚Üí `wrmeans11833@gmail.com`
- Customer 2: "Yubi 202311223738" with phone 9317043000 ‚Üí `wrmeans11833@gmail.com`
- Customer 3: "Wylica Morgan" with phone 202311221321 ‚Üí `wrmeans11833@gmail.com`

These are **3 different people** who all have the same placeholder email.

**The script now skips these placeholder emails** when linking phone-only and email-only records to avoid false matches.

---

## üìä What Each File Contains

### `customer_analytics_updated_YYYY-MM-DD.csv` (FINAL FILE)
- Customer ID, Code, Name
- **Email** (if available, may be placeholder)
- **Phone** (if available)
- Lifetime Value, Order Count, AOV
- First/Last Order Dates
- Customer Segments (VIP, High Value, Inactive)
- Tier (Seed, Sprout, Bloom, Evergreen)
- **Combined Retail + eCom orders** (if eCom data was merged)

---

## üöÄ Quick Reference

**To regenerate the final analytics:**
```bash
# Step 1: Import eCom data (if you have a new eCom CSV export)
npx tsx scripts/importEcomCSV.ts

# Step 2: Generate base analytics (uses cache for speed)
npx tsx scripts/analyzeCustomerMetrics.ts --reuse-customers --cache

# Step 3: Merge everything into final file
npx tsx scripts/mergeEcomIntoAnalytics.ts
```

**Result:** `customer_analytics_updated_YYYY-MM-DD.csv` ‚Üê **Use this file!**

---

## üîç Testing a Specific Customer

Use the quick test script:
```bash
npx tsx scripts/quickCustomerCheck.ts --email your@email.com
# or
npx tsx scripts/quickCustomerCheck.ts --phone 5551234567
```
